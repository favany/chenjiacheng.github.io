---
layout: post
categories: 操作系统
tags: [操作系统]
---

## 操作系统的概念、功能

### 概念（定义）

* 负责管理协调硬件、软件等计算机资源的工作
* 为上层用户、应用程序提供简单易用的服务
* 是一种系统软件

### 目标和功能

**资源的管理者**

- 处理机管理
- 存储器管理
- 文件管理
- 设备管理

**向用户提供服务**

- 命令接口（联机命令接口、脱机命令接口）
- 程序接口（由一组系统调用组成）
- GUI 用户图形界面

**对硬件机器的扩展**

* 扩充机器

## 操作系统的特征

操作系统是一种系统软件，但与其他系统软件和应用软件有很大的不同，它有自己的特殊性即基本特征。操作系统的基本特征包括**并发**、**共享**、**虚拟**和**异步**。

### 并发(Concurrence)

并发是指两个或多个事件在同一时间间隔内发生，这些事件**宏观上是同时发生**的，但**微观上是交替发生**的。

### 共享(Sharing)

资源共享即共享，是指系统中的资源可供内存中多个并发执行的进程共同使用。

**两种资源共享方式：**

* **互斥共享方式：**系统中的某些资源，虽然可以提供给多个进程使用，但**一个时间段内只允许一个进程访问该资源**，如对摄像头设备的共享使用。

* **同时访问方式：**系统中的某些资源，**允许一个时间段内由多个进程 “同时” 对它们进行访问**，如对硬盘资源的共享使用。

**并发和共享的关系：**

* 如果失去并发性，则系统中只有一个程序正在运行，则共享性失去存在的意义。
* 如果失去共享性，则系统中的程序不能同时访问硬盘资源，就无法实现同时发送文件，也就无法并发。

### 虚拟(Virtual)

虚拟是指把一个物理上的实体变为若干逻辑上的对应物。物理实体（前者）是实的，即实际存在的，而后者是虚的，是用户感觉上的事物。

**虚拟技术：**

* **时分复用技术**，如处理器的分时共享。

* **空分复用技术**，如虚拟存储器。

### 异步(Asynchronism)

多道程序环境允许多个程序并发执行，但由于资源有限，进程的执行并不是一贯到底的，而是走走停停的，它以不可预知的速度向前推进，这就是进程的异步性。

## 操作系统的发展与分类

### 手工操作阶段

* 缺点：人机速度矛盾

### 批处理阶段

* **单道批处理系统（引入脱机输入/输出技术）**
  * 优点：缓解人机速度矛盾
  * 缺点：资源利用率依然很低

* **多道批处理系统（操作系统开始出现）**
  * 优点：多道程序并发执行，资源利用率高
  * 缺点：不提供人机交互功能

### 分时操作系统

* 提供人机交互功能
* 不能有限处理紧急任务

### 实时操作系统

* 硬实时系统（必须在绝对严格的规定时间内完成处理）
* 软实时系统（能接受偶尔违反时间规定）
* 优点：能有点处理紧急任务

### 网络操作系统

### 分布式操作系统

### 个人计算机操作系统

## 操作系统的运行机制和体系结构

### 运行机制

* 两种指令
  * 特权指令：如内存清零指令（不允许用户程序使用）
  * 非特权指令：如普通的运算指令
* 两种处理状态
  * 核心态（此时CPU只能执行非特权指令）
  * 用户态（特权指令、非特权指令都可执行）
* 两种程序
  * 内核程序：操作系统的内核程序是系统的管理者，既可以执行特权指令，也可以执行非特权指令，运行在在核心态
  * 应用程序：为了保证系统安全运行，普通应用程序只能执行非特权指令，运行在用户态

### 操作系统内核

![01.png](/static/images/20210901/01.png)

* 时钟管理：实现计时功能
* 中断管理：负责实现中断机制
* 原语：是一种特殊的程序，其执行具有原子性

### 操作系统的体系结构

![02.png](/static/images/20210901/02.png)

* 大内核（将操作系统的主要功能模块作为系统内核，运行在核心态）
  * 优点：高性能
  * 缺点：内核代码庞大，结构混乱，难以维护
* 微内核（只把最基本的功能保留在内核）
  * 优点：内核功能少，结构清晰，方便维护
  * 缺点：需要频繁地在核心态和用户态之间切换，性能低

## 中断和异常

### 中断机制的诞生

为了实现多道程序并发执行而引入的一种技术

### 中断的概念的作用

* 发生中断，就意味着需要操作系统接入开展管理工作，CPU 会立即进入核心态
* “中断” 是 CPU 从用户态进入核心态的唯一途径

### 中断的分类

* 内中断（也称异常、例外、陷入）
  * 自愿中断（指令中断）
  * 强逼中断（硬件故障、软件中断）
* 外中断（中断）
  * 外设请求
  * 人工干预

### 内中断的另一种分类分式

* 陷阱、陷入（Trap）：有意而为之的异常，如系统调用
* 故障（fault）：由错误条件引起的，可能被故障处理程序修复，如缺页
* 终止（abort）：不可恢复的致命错误造成的结果，终止处理程序不再将控制返回给引发终止的应用程序，如整数除 0

### 外中断的处理过程

* 每条指令执行结束后，CPU 检查是否有外部中断信号
* 若有外部中断信号，则需要保护被中断进程的 CPU 环境
* 根据中断信号类型转入相应的中断处理程序
* 恢复原进程的 CPU 环境并退出中断，返回原进程继续往下执行

## 系统调用

### 什么是系统调用，有何作用？

* 操作系统提供给应用程序使用的接口
* 应用程序通过系统调用来请求获得操作系统的服务
* 系统调用会使处理器从用户态进入核心态
* 按功能分类
  * 设备管理：完成设备的请求/释放/启动等功能
  * 文件管理：完成文件的读/写/创建/删除等功能
  * 进程控制：完成文件的读/写/创建/删除等功能（凡是与资源有关的操作、会 直接影响到其他进程的操作，一定需要操作系统介入，即需要通过系统调用来实现）
  * 进程通信：完成进程之间的消息传递/信号传递等功能
  * 内存管理：完成内存的分配/回收等功能

### 系统调用和库函数的区别

* 系统调用是操作系统向上层提供的接口
* 有的库函数是对系统调用的进一步封装 
* 当今编写的应用程序大多是通过高级语言提供的库函数间接地进行系统调用

### 系统调用背后的过程

1. 传递系统调用参数
2. 执行陷入指令（系统调用发生在用户态，对系统调用的处理发生在核心态。执行陷入指今会产生内中断，使处理器从用户态进核心态）
3. 执行系统调用相应服务程序 
4. 返回用户程序